{# health_report.j2 - Dynamically aggregate multi-host health check report #}
{# Top metadata section (control node generation time) #}
System Healthcheck Report @ {{ ansible_date_time.iso8601 }}
Target Host Group: {{ groups['rhel7'] | join(', ') }}
Generated by: {{ ansible_user_id }} on {{ ansible_hostname }}

{# Core content section (dynamically inject healthdata_collection variable) #}
{{ healthdata_collection }}

{# Bottom summary statistics #}
{# ------------------------ #}
{% set total_hosts = groups['rhel7'] | length %}
{% set data_processed = healthdata_collection | regex_findall('### Host:') | length %}
Report Summary:
  - Total Hosts Scanned: {{ total_hosts }}
  - Successful Data Collection: {{ data_processed }}
  - Failed Hosts: {{ total_hosts - data_processed }}
